<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.4.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Katherine Hoffman">

  
  
  
    
  
  <meta name="description" content="A Visual Guide and Introductory R Tutorial on TMLE aimed at applied scientists with statistics training.
 TMLE in two sentences  The most basic form of Targeted Maximum Likelihood Estimation (TMLE) allows you to estimate treatment effects of interest using:
the expected outcome of an individual, given the treatment they received and their baseline confounders
 the probability an individual received the treatment of interest, given their baseline confounders [propensity score]">

  
  <link rel="alternate" hreflang="en-us" href="/blog/tmle/tmle-tutorial-3/">

  


  

  
  
  
  <meta name="theme-color" content="#3f51b5">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    

    

  

  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700|Roboto:400,400italic,700|Roboto+Mono&display=swap">
  

  
  
  
  <link rel="stylesheet" href="/css/academic.min.ce53f5d1ff75f9f89bb1c243b514bb45.css">

  

  
  
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-136820093-1', 'auto');
      
      ga('require', 'eventTracker');
      ga('require', 'outboundLinkTracker');
      ga('require', 'urlChangeTracker');
      ga('send', 'pageview');
    </script>
    <script async src="https://www.google-analytics.com/analytics.js"></script>
    
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/autotrack/2.4.1/autotrack.js" integrity="sha512-HUmooslVKj4m6OBu0OgzjXXr+QuFYy/k7eLI5jdeEy/F4RSgMn6XRWRGkFi5IFaFgy7uFTkegp3Z0XnJf3Jq+g==" crossorigin="anonymous"></script>
    
  
  

  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon-32.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/blog/tmle/tmle-tutorial-3/">

  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="twitter:site" content="@rkatlady">
  <meta property="twitter:creator" content="@rkatlady">
  
  <meta property="og:site_name" content="KHstats">
  <meta property="og:url" content="/blog/tmle/tmle-tutorial-3/">
  <meta property="og:title" content="What in Tarnation is Targeted Maximum Likelihood Estimation? | KHstats">
  <meta property="og:description" content="A Visual Guide and Introductory R Tutorial on TMLE aimed at applied scientists with statistics training.
 TMLE in two sentences  The most basic form of Targeted Maximum Likelihood Estimation (TMLE) allows you to estimate treatment effects of interest using:
the expected outcome of an individual, given the treatment they received and their baseline confounders
 the probability an individual received the treatment of interest, given their baseline confounders [propensity score]"><meta property="og:image" content="/img/icon-192.png">
  <meta property="twitter:image" content="/img/icon-192.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2020-10-10T21:13:14-05:00">
    
    <meta property="article:modified_time" content="2020-10-10T21:13:14-05:00">
  

  


  





  <title>What in Tarnation is Targeted Maximum Likelihood Estimation? | KHstats</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0 compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/">KHstats</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav mr-auto">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#hero"><span>About</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#experience"><span>Experience</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#blogs"><span>Blog</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#talks"><span>Talks</span></a>
        </li>

        
        

      
      </ul>
      <ul class="navbar-nav ml-auto">
      

        

        
        <li class="nav-item">
          <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        

        
        <li class="nav-item">
          <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
        </li>
        

      </ul>

    </div>
  </div>
</nav>


  <article class="article" itemscope itemtype="http://schema.org/Article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1 itemprop="name">What in Tarnation is Targeted Maximum Likelihood Estimation?</h1>

  

  
    



<meta content="2020-10-10 21:13:14 -0500 -0500" itemprop="datePublished">
<meta content="2020-10-10 21:13:14 -0500 -0500" itemprop="dateModified">

<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    <time>Oct 10, 2020</time>
  </span>
  

  

  

  
  
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/categories/r/">R</a></span>
  

  
    
<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=/blog/tmle/tmle-tutorial-3/&amp;text=What%20in%20Tarnation%20is%20Targeted%20Maximum%20Likelihood%20Estimation?" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=/blog/tmle/tmle-tutorial-3/&amp;t=What%20in%20Tarnation%20is%20Targeted%20Maximum%20Likelihood%20Estimation?" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook-f"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=What%20in%20Tarnation%20is%20Targeted%20Maximum%20Likelihood%20Estimation?&amp;body=/blog/tmle/tmle-tutorial-3/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=/blog/tmle/tmle-tutorial-3/&amp;title=What%20in%20Tarnation%20is%20Targeted%20Maximum%20Likelihood%20Estimation?" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://web.whatsapp.com/send?text=What%20in%20Tarnation%20is%20Targeted%20Maximum%20Likelihood%20Estimation?%20/blog/tmle/tmle-tutorial-3/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=/blog/tmle/tmle-tutorial-3/&amp;title=What%20in%20Tarnation%20is%20Targeted%20Maximum%20Likelihood%20Estimation?" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>


  

</div>

    














  
</div>



  <div class="article-container">

    <div class="article-style" itemprop="articleBody">
      


<blockquote>
<p>A Visual Guide and Introductory R Tutorial on TMLE aimed at applied scientists with statistics training.</p>
</blockquote>
<hr />
<div id="tmle-in-two-sentences" class="section level1">
<h1>TMLE in two sentences</h1>
<ul>
<li><p>The most basic form of Targeted Maximum Likelihood Estimation (TMLE) allows you to estimate treatment effects of interest using:</p>
<ol style="list-style-type: decimal">
<li><p>the expected outcome of an individual, given the treatment they received and their baseline confounders</p></li>
<li><p>the probability an individual received the treatment of interest, given their baseline confounders [propensity score]</p></li>
</ol></li>
<li><p>These estimates can come regressions we commonly classify as machine learning (ML), but the overall estimate of the treatment effect will still have <strong>valid confidence intervals</strong>, unlike the estimates you normally get from ML</p></li>
</ul>
<hr />
</div>
<div id="is-tmle-causal-inference" class="section level1">
<h1>Is TMLE Causal Inference?</h1>
<p>TMLE was <em>developed</em> to answer causal inference questions, but the estimates from TMLE do not have a causal interpretation by themselves. TMLE is merely a tool, or an algorithm, used to estimate treatment effects.</p>
<p>When approaching a causal inference question (or really any statistical estimation application at all!), the majority of time and effort should often be focused on the underlying scientific model, research question of interest, and data available to answer it.</p>
<p>Once this process – usually called <strong>identification</strong>* in the causal inference literature – is completed and an analyst is ready to estimate an effect of interest, she/he has a choice in estimation methods.</p>
<p>You’ve likely heard of some of these estimation methods: propensity score matching, inverse probability weighting, g-computation (AKA substitution estimation), etc. TMLE is an estimation method just like these, however, it has some very appealing properties that I am convinced make it a better option than the aforementioned methods.</p>
<p>*I won’t go into identification in this post, but if you are new to causal inference, my favorite book so far to understand the big picture of identification is Part I of Miguel Hernan and James Robins’ <a href="https://cdn1.sph.harvard.edu/wp-content/uploads/sites/1268/2019/11/ci_hernanrobins_10nov19.pdf">“Causal Inference: What If”</a> book.</p>
</div>
<div id="tmle-real-intuitively" class="section level1">
<h1>TMLE, real intuitively</h1>
<p>All causal inference methods try to use information about why patients were treated (non-randomly, unless it was an RCT) to</p>
<p>Before I walk through the <code>R</code> code for the TMLE algorithm, I want to reinforce the big-picture idea of TMLE: we want to use information about why patients get treatment to update their outcomes</p>
</div>
<div id="the-tmle-algorithm" class="section level1">
<h1>The TMLE Algorithm</h1>
<pre class="r"><code>library(tidyverse)
library(SuperLearner)
set.seed(7)

# Superlearner functions from Ivan
source(&quot;sl.r&quot;)

# using data generating code from Miguel Angel Luque Fernandez&#39; tutorial
generate_data &lt;- function(n){
    w1 &lt;- rbinom(n, size=1, prob=0.5)
    w2 &lt;- rbinom(n, size=1, prob=0.65)
    w3 &lt;- round(runif(n, min=0, max=4), digits=3)
    w4 &lt;- round(runif(n, min=0, max=5), digits=3)
    A  &lt;- rbinom(n, size=1, prob= plogis(-0.4 + 0.2*w2 + 0.15*w3 + 0.2*w4 + 0.15*w2*w4))
    # counterfactual
    Y_1 &lt;- rbinom(n, size=1, prob= plogis(-1 + 1 -0.1*w1 + 0.3*w2 + 0.25*w3 + 0.2*w4 + 0.15*w2*w4))
    Y_0 &lt;- rbinom(n, size=1, prob= plogis(-1 + 0 -0.1*w1 + 0.3*w2 + 0.25*w3 + 0.2*w4 + 0.15*w2*w4))
    # Observed outcome
    Y &lt;- Y_1*A + Y_0*(1 - A)
    # return data.frame
    tibble(w1, w2, w3, w4, A, Y, Y_1, Y_0)
}

# observations N
n &lt;- 10000

# full data set, including Y0 and Y0
dat_full &lt;- generate_data(n)

# calculate the true psi if we saw both outcomes
true_psi &lt;- mean(dat_full$Y_1 - dat_full$Y_0)

# make a data set with observed data only
dat_obs &lt;- dat_full %&gt;%
  select(-Y_1,-Y_0)
 

# set SL libraries
lib &lt;- c(&#39;SL.speedglm&#39;, # faster glm
         &#39;SL.glmnet&#39;, # lasso
         &#39;SL.ranger&#39;, # random forest
         &#39;SL.earth&#39;)  #


# estimate Q --------------------------------------------------------------

Y &lt;- dat_obs$Y
X_Y &lt;- dat_obs %&gt;% select(-Y)

Q &lt;- SuperLearner(Y = Y, X = X_Y,
                    family=binomial(),
                    SL.library=lib,
                    # metalearner = NNloglik for binary outcomes, NNLS for continuous
                    method = method.NNloglik,
                    # 5-fold cross validation
                    cvControl = list(V = 5))

# estimate g --------------------------------------------------------------

A &lt;- dat_obs$A
X_A &lt;- dat_obs %&gt;% select(-Y, -A)

g &lt;- SuperLearner(Y = A, X = X_A,
                    family=binomial(),
                    SL.library=lib,
                    # metalearner = NNloglik for binary outcomes, NNLS for continuous
                    method = method.NNloglik,
                    # 5-fold cross validation
                    cvControl = list(V = 5))


# predictions for Q -------------------------------------------------------

Q_A &lt;- predict(Q)$pred

X_Y_A1 &lt;- X_Y %&gt;% mutate(A = 1) 
Q_1 &lt;- predict(Q, newdata = as.data.frame(X_Y_A1))$pred

X_Y_A0 &lt;- X_Y %&gt;% mutate(A = 0)
Q_0 &lt;- predict(Q, newdata = X_Y_A0)$pred


# create clever covariate -------------------------------------------------

H_1 &lt;- 1/predict(g)$pred
H_0 &lt;- -1/(1-predict(g)$pred)

# prep data to fit the clever covariate
dat_cc &lt;-
  dat_obs %&gt;%
  mutate(Q_A = as.vector(Q_A),
         H = case_when(A == 1 ~ H_1,
                       A == 0 ~ H_0)) %&gt;%
  select(Y, A, Q_A, H)

# fit parametric working model
glm_fit &lt;- glm(Y ~ -1 + offset(qlogis(Q_A)) + H, data=dat_cc, family=binomial)
# get epsilon
eps &lt;- coef(glm_fit)
# also get H as a vector (for Q_A_update)
H &lt;- dat_cc$H

# update expected outcome estimates (Q star) ------------------------------

# update
Q_1_update &lt;- plogis(qlogis(Q_1) + eps*H_1)
Q_0_update &lt;- plogis(qlogis(Q_0) + eps*H_0)
Q_A_update &lt;- plogis(qlogis(Q_A) + eps*H)

# Estimate ATE ------------------------------------------------------------

# get the ATE TMLE
tmle_psi &lt;- mean(Q_1_update - Q_0_update)

# compare to true parameter
tmle_psi
true_psi 


# Calculate SEs -----------------------------------------------------------

ic &lt;- (dat_obs$Y - Q_A_update) * H + Q_1_update + Q_0_update
tmle_se &lt;- sqrt(var(ic)/nrow(dat_obs))

ci_lo &lt;- tmle_psi - 1.96*tmle_se
ci_hi &lt;- tmle_psi + 1.96*tmle_se

pval &lt;- 2 * (1 - pnorm(abs(tmle_psi / tmle_se)))


# Compare with TMLE package -----------------------------------------------------------

tmle_fit &lt;- tmle::tmle(Y, A, X_A,
                       gbound = .000000001, # trying 
                       Q.SL.library = lib, g.SL.library = lib)
tmle_fit$epsilon # mine are different :(
tmle_fit$estimates$ATE</code></pre>
<p>Essentially, you start with the estimate of an individual’s outcome given their treatment and baseline covariates, and you update that estimate using the probability an individual received the treatment given their baseline covariates. Every time you update that estimate, you remove more of the bias that naturally exists in your observational data.</p>
</div>
<div id="why-should-i-bother-with-tmle" class="section level1">
<h1>Why should I bother with TMLE?</h1>
<p>Before I show an applied example of TMLE, I want to explain why I prefer TMLE to other propensity score estimation methods. In short, it is because because you don’t need to fit any certain type of regression to get your final estimates. You can use any estimator you want – a generalized linear model, splines, random forests, gradient boosting, neural nets, honestly anything – to get the initial probability estimates. You can actually use <em>all</em> of those estimators to get the two probability estimates, if you want! But more on that later.</p>
<p>The benefit of expanding your toolbox of potential estimators is that most estimators are built with prediction in mind, and thus yield very good probability estimates to initiate our TMLE algorithm. When our goal as statisticians is to calculate effects on an outcome attributable to a treatment, it’s easy to shy away from these prediction-focused types of estimators, because most of them do not have any statistical theory to allow us to calculate valid confidence intervals.</p>
<p><strong>A huge selling point of TMLE is that it allows you to utilize prediction-focused (often non-parametric) estimators, but still obtain valid confidence intervals on your final estimate of the treatment’s effect.</strong> TMLE utilizes concepts from semi-parametric influence function theory to determine valid standard errors, and therefore valid confidence intervals, on estimates of treatment effects. This is not important unless you plan to tackle the math of TMLE, but if you do decide to venture into technical explanations, know that you’ll see references to influence functions <em>a lot</em>!</p>
<p>In other propensity score methods, like IPTW, we can only obtain valid confidence intervals if we obtain our propensity score using pre-specified parametric models. For example, we fit a logistic regression for our treatment predicted by five pre-specified baseline covariates. Using a logistic model like this to calculate the propensity score is not only placing a strong distributional assumption on our data, but it is limited in its ability to take in high-, or even medium-dimensional data. When we use estimators that are well equipped for very “wide” data and perform variable selection, we obtain better overall estimates for our treatment effect of interest.</p>
<p>There are a few other major benefits to TMLE. For one, it has very good bias-variance properties, and those properties are “robust,” or “resistant to” model mispecification, i.e. having the wrong type of estimator or the wrong variables in your estimation of either the treatment or outcome. Another benefit is that if you are able to go through a causal identification process of the research question and available data (a concept I won’t discuss further, since it’s a separate realm of the problem), you’ll have a causal interpretation of your average treatment effect estimate.</p>
</div>
<div id="a-real-world-application-of-tmle" class="section level1">
<h1>A Real World Application of TMLE</h1>
<pre class="r"><code>library(dplyr, warn.conflicts=F)</code></pre>
<p>Here I’ll be using a data set from the ???. EXPLAIN DATA aND goal</p>
<p>I chose this data set because it is the same data used in a really good resource if you want to do a deeper dive in Targeted Learning:</p>
<pre class="r"><code>washb_data &lt;- data.table::fread(&quot;https://raw.githubusercontent.com/tlverse/tlverse-data/master/wash-benefits/washb_data.csv&quot;,
                    stringsAsFactors = TRUE)</code></pre>
<p>Before we can run a TMLE analysis, we need to clean the data a bit. The <code>tmle</code> function requires a binary treatment, so I’ll need to turn the treatment data from character strings to binary 0/1 variables. I’m only interested right now in women who recieved the treatment of Nutrition and Hand washing, and comparing that to the control women, so I’ll filter out the appropriate subjects and make my data binary.</p>
<p>To use <code>tmle</code>, your data structure should be:</p>
<ul>
<li><p>Wide (each row is one observation)</p></li>
<li><p>No factors (all categorical variables should be transformed to dummy/indicator columns using a function like <code>model.matrix()</code></p></li>
<li><p>No missing data (I usually make a new column indicating whether the value was missing, and then impute at the mean or median for continuous variables)</p></li>
</ul>
<pre class="r"><code>dat_clean &lt;- 
  washb_data %&gt;%
  filter(tr %in% c(&quot;Control&quot;, &quot;Nutrition + WSH&quot;)) %&gt;%
  mutate(tr = case_when(tr == &quot;Control&quot; ~ 0,
                        TRUE ~ 1)) %&gt;%
  mutate_at(vars(one_of(c(&quot;momage&quot;,&quot;momheight&quot;))), list(miss =~ ifelse(is.na(.), 1, 0))) %&gt;%
  mutate_at(vars(one_of(&quot;momage&quot;,&quot;momheight&quot;)), list( ~ ifelse(is.na(.), mean(., na.rm=T), .))) %&gt;%
  model.matrix(~ . + 0, data = .) %&gt;%
  as.data.frame()</code></pre>
<p>Once I’ve cleaned my data, I make vectors specifying my treatment, outcome, and baseline covariates. In the TMLE literature, and in this package, the notations are:</p>
<ul>
<li><p>Outcome: <code>Y</code></p></li>
<li><p>Treatment: <code>A</code></p></li>
<li><p>Confounders: <code>W</code></p></li>
</ul>
<p>In this data set, our outcome is the variable <code>whz</code>, our treatment is the variable <code>tr</code>, and our baseline confounders are all the other variables in our data set.</p>
<pre class="r"><code>Y &lt;- dat_clean$whz
A &lt;- dat_clean$tr
W &lt;- dat_clean %&gt;% dplyr::select(-whz, -tr)</code></pre>
<p>Once we’ve done that, we can get our TMLE estimate of the average treatment effect! Here, I’m only inputting the</p>
<pre class="r"><code>tmlefit_default &lt;- tmle::tmle(Y, A, W)
tmlefit_default</code></pre>
<p>Here, I’m going to specify the kinds of estimators I want to use to get my two important estimates: the expected outcome and the probability of the exposure.</p>
<p>I’ve chosen to call the functions <code>glm</code> for a generalized linear model, <code>glmnet</code> for penalized regression, <code>ranger</code> for random forests, and <code>xgboost</code> for extreme gradient boosting.</p>
<p>I’m going to use <em>all</em> of these estimators to estimate the</p>
<pre class="r"><code>SL_library &lt;- c(&quot;SL.glm&quot;,
                &quot;SL.glmnet&quot;,
                &quot;SL.ranger&quot;,
                &quot;SL.xgboost&quot;)</code></pre>
<p>We’re going to specify those libraries in the arguments <code>Q.SL.library</code> and <code>g.SL.library</code>. These arguments sound a bit scary, but they are just what the notation in TMLE literature is – Q refers to the estimation for the outcome given treatment and covariates, and g refers to the estimation of the probability of the treatment.</p>
<pre class="r"><code>tmlefit &lt;- tmle::tmle(Y, A, W,
                Q.SL.library = SL_library, g.SL.library = SL_library)
tmlefit</code></pre>
<p>To understand how the various machine learning models are combining, you should look into a type of ensemble learning called stacking, or “superlearning.” I have a slideshow that you could look at <a href="https://github.com/hoffmakl/sl3-demo/blob/master/superlearning_slides_no_animation.pdf">here</a>, but there are plenty of other resources online.</p>
<p>This is obviously not a super technical post, and it was not intended to be, but I hope that it may catch your interest to learn more about the complexities of TMLE and try it out in your next analysis. I plan to write a few similar posts on what to do if your outcomes are survival or longitudinal data. In the meantime, you may find the more technical tutorial on TMLE helpful:</p>
<p>or, “The Hitchiker’s Guide to Targeted Learning” is an excellent, still-in-progress, resource for learning TMLE and many other targeted learning.</p>
<p>Learn about causal inference,</p>
<p>we should be estimating answers for questions of actual interest, rather than debiasing our results.</p>
</div>
<div id="references" class="section level1">
<h1>References:</h1>
</div>

    </div>

    


    

<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/r/">R</a>
  
</div>



    
      








  





  
  
  
    
  
  
  <div class="media author-card" itemscope itemtype="http://schema.org/Person">
    
      
      <img class="portrait mr-3" src="/authors/admin/avatar_hub64370a9fa8c7276c9d6cc9d2e350075_235979_250x250_fill_q90_lanczos_center.jpg" itemprop="image" alt="Avatar">
    

    <div class="media-body">
      <h5 class="card-title" itemprop="name"><a href="/">Katherine Hoffman</a></h5>
      <h6 class="card-subtitle">Research Biostatistician</h6>
      <p class="card-text" itemprop="description">I am passionate about meaningful, reproducible medical research.</p>
      <ul class="network-icon" aria-hidden="true">
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="/#contact" >
              <i class="fas fa-envelope"></i>
            </a>
          </li>
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="https://twitter.com/Rkatlady" target="_blank" rel="noopener">
              <i class="fab fa-twitter"></i>
            </a>
          </li>
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="https://github.com/hoffmakl" target="_blank" rel="noopener">
              <i class="fab fa-github"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>



      
      
      <div class="article-widget">
        <div class="hr-light"></div>
        <h3>Related</h3>
        <ul>
          
          <li><a href="/blog/sl/superlearning/">Become a Superlearner! A Visual Guide &amp; Introductory R Tutorial on Superlearning</a></li>
          
          <li><a href="/blog/covid-wrangling/covid-functions/">My favorite lines of data wrangling code during the NYC COVID-19 outbreak</a></li>
          
          <li><a href="/blog/corr-plots/corr-plots/">Customizable correlation plots in R</a></li>
          
          <li><a href="/blog/iterated-expectations/iterated-expectations/">Understanding Conditional and Iterated Expectations with a Linear Regression Model</a></li>
          
          <li><a href="/blog/trt-timelines/trt-timelines/">Patient Treatment Timelines for Longitudinal Survival Data</a></li>
          
        </ul>
      </div>
      
    

    

    


  </div>
</article>

      

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js" integrity="sha256-aYTdUrn6Ow1DDgh5JTc3aDGnnju48y/1c8s1dgkYPQ8=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/r.min.js"></script>
        
      

      
      
    

    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "results found",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.16bbb3750feb7244c9bc409a5a4fe678.js"></script>

    






  
  <div class="container">
    <footer class="site-footer">
  
  <p class="powered-by">
    
      <a href="/privacy/">Privacy Policy</a>
    
    
       &middot; 
      <a href="/terms/">Terms</a>
        
  </p>
  

  <p class="powered-by">
    

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" id="back_to_top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
